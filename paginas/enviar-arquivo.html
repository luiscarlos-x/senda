<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../css/image/senda.png">
    <title>Enviar Arquivo - Senda</title>
    <meta name="description" content="Envie seus arquivos de forma instantânea e segura">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/send-file.css">
    <script src="../javascript/theme.js"></script>
    <!-- Socket.io Client -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>

<body>
    <div class="container">
        <header class="header">
            <div class="logo" onclick="window.location.href='/'">
                <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 5L35 15V25L20 35L5 25V15L20 5Z" stroke="url(#logo-gradient)" stroke-width="2"
                        fill="url(#logo-fill)" />
                    <circle cx="20" cy="20" r="6" fill="white" />
                    <defs>
                        <linearGradient id="logo-gradient" x1="5" y1="5" x2="35" y2="35">
                            <stop offset="0%" stop-color="#5F6F52" />
                            <stop offset="100%" stop-color="#A4B494" />
                        </linearGradient>
                        <linearGradient id="logo-fill" x1="5" y1="5" x2="35" y2="35">
                            <stop offset="0%" stop-color="#5F6F52" stop-opacity="0.3" />
                            <stop offset="100%" stop-color="#4A5842" stop-opacity="0.1" />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="logo-text">Senda</span>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Alternar tema">
                <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
                </svg>
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5" />
                    <line x1="12" y1="1" x2="12" y2="3" />
                    <line x1="12" y1="21" x2="12" y2="23" />
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                    <line x1="1" y1="12" x2="3" y2="12" />
                    <line x1="21" y1="12" x2="23" y2="12" />
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                </svg>
            </button>
        </header>

        <main class="send-main">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1-indicator">
                    <div class="step-number">1</div>
                    <div class="step-label">Conectar</div>
                </div>
                <div class="step-divider"></div>
                <div class="step" id="step2-indicator">
                    <div class="step-number">2</div>
                    <div class="step-label">Enviar</div>
                </div>
            </div>

            <!-- Step 1: Choose connection method -->
            <div class="step-content active" id="step1-content">
                <div class="send-hero">
                    <h1 class="send-title">
                        Como deseja <span class="gradient-text">conectar</span>?
                    </h1>
                    <p class="send-subtitle">
                        Escolha uma das opções abaixo para conectar com o dispositivo
                    </p>
                </div>

                <div class="connection-methods">
                    <div class="method-card" id="qrCodeMethod">
                        <div class="method-icon">
                            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="8" y="8" width="20" height="20" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                                <rect x="12" y="12" width="12" height="12" fill="currentColor" />
                                <rect x="36" y="8" width="20" height="20" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                                <rect x="40" y="12" width="12" height="12" fill="currentColor" />
                                <rect x="8" y="36" width="20" height="20" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                                <rect x="12" y="40" width="12" height="12" fill="currentColor" />
                                <path
                                    d="M36 36H44M36 40H44M36 44H44M48 36H56M48 40H56M48 44H56M36 48H44M36 52H44M48 48H56M48 52H56M52 56H56"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                            </svg>
                        </div>
                        <h2 class="method-title">Escanear QR Code</h2>
                        <p class="method-description">
                            Aponte a câmera do seu celular para o QR Code na tela do dispositivo que receberá o arquivo
                        </p>
                        <button class="method-button" onclick="showQRScanner()">
                            <span>Abrir câmera</span>
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" />
                            </svg>
                        </button>
                    </div>

                    <div class="method-divider">
                        <span>OU</span>
                    </div>

                    <div class="method-card" id="codeMethod">
                        <div class="method-icon">
                            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="8" y="24" width="12" height="16" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                                <rect x="26" y="24" width="12" height="16" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                                <rect x="44" y="24" width="12" height="16" stroke="currentColor" stroke-width="2"
                                    rx="2" />
                            </svg>
                        </div>
                        <h2 class="method-title">Digitar código</h2>
                        <p class="method-description">
                            Digite o código de 4 dígitos fornecido pelo dispositivo que receberá o arquivo
                        </p>
                        <button class="method-button" onclick="showCodeInput()">
                            <span>Digitar código</span>
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Code Input Section (Hidden initially) -->
                <div class="code-input-section" id="codeInputSection" style="display: none;">
                    <button class="back-button" onclick="hideCodeInput()">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" />
                        </svg>
                        Voltar
                    </button>

                    <div class="code-input-container">
                        <h2 class="code-input-title">Digite o código</h2>
                        <p class="code-input-subtitle">Insira o código de 4 dígitos</p>

                        <div class="code-digits">
                            <input type="text" maxlength="1" class="code-digit" id="digit1" autocomplete="off">
                            <input type="text" maxlength="1" class="code-digit" id="digit2" autocomplete="off">
                            <input type="text" maxlength="1" class="code-digit" id="digit3" autocomplete="off">
                            <input type="text" maxlength="1" class="code-digit" id="digit4" autocomplete="off">
                        </div>

                        <div class="code-error" id="codeError" style="display: none;">
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <span id="codeErrorMessage">Código inválido</span>
                        </div>

                        <button class="code-connect-button" id="connectButton" onclick="validateCode()" disabled>
                            <span>Conectar</span>
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- QR Scanner Section (Hidden initially) -->
                <div class="qr-scanner-section" id="qrScannerSection" style="display: none;">
                    <button class="back-button" onclick="hideQRScanner()">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" />
                        </svg>
                        Voltar
                    </button>

                    <div class="qr-scanner-container">
                        <div class="qr-scanner-frame">
                            <!-- Container for html5-qrcode camera feed -->
                            <div id="qr-reader"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Upload file (Hidden initially) -->
            <div class="step-content" id="step2-content" style="display: none;">
                <div class="upload-container">
                    <div class="connected-badge">
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                clip-rule="evenodd" />
                        </svg>
                        <span>Conectado</span>
                    </div>

                    <h1 class="upload-title">
                        Envie seu <span class="gradient-text">arquivo</span>
                    </h1>
                    <p class="upload-subtitle">
                        Selecione o arquivo que deseja enviar ao atendente
                    </p>

                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.docx" multiple
                            style="display: none;">
                        <label for="fileInput" class="upload-label">
                            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="32" cy="32" r="28" stroke="currentColor" stroke-width="2" opacity="0.2" />
                                <path d="M32 20V44M32 20L24 28M32 20L40 28" stroke="currentColor" stroke-width="3"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span class="upload-text">Clique ou arraste seus arquivos aqui</span>
                            <span class="upload-hint">Até 5 arquivos • PDF, JPG, PNG ou DOCX • Máx. 50MB total</span>
                        </label>
                    </div>

                    <!-- File previews (populated dynamically) -->
                    <div class="files-preview-list" id="filesPreviewList" style="display: none;"></div>

                    <button class="upload-button" id="uploadButton" onclick="uploadFile()" disabled>
                        <span>Enviar arquivo</span>
                        <svg viewBox="0 0 20 20" fill="currentColor">
                            <path
                                d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" />
                        </svg>
                    </button>

                    <!-- Upload progress (Hidden initially) -->
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">Enviando... 0%</div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2026 Senda. Todos os direitos reservados.</p>
        </footer>
    </div>

    <!-- html5-qrcode Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="../javascript/script.js"></script>
    <script src="../javascript/send-file.js"></script>
</body>

</html>